/*
 Copyright @ 2014 Alessandro Zifiglio. All rights reserved. http://www.booki.io
*/
(function(i){var m=m||{};m.createDelegate=function(h,d){return function(){return d.apply(h,arguments)}};m.createCallback=function(h,d,a){return function(){var b=arguments.length;if(b>0){for(var c=[],e=0;e<b;e++)c[e]=arguments[e];c[b]=a;return h.apply(d||this,c)}return h.call(d||this,a)}};i.Booki||(i.Booki=m)})(window,document);
(function(i){var m=i.Booki||function(){};m.Cookie=function(){};m.Cookie.create=function(h,d,a){var b;if(a){b=new Date;b.setTime(b.getTime()+a*24*60*60*1E3);a="; expires="+b.toGMTString()}else a="";document.cookie=h+"="+d+a+"; path=/"};m.Cookie.read=function(h){h=h+"=";var d=document.cookie.split(";"),a,b;for(b=0;b<d.length;b++){for(a=d[b];a.charAt(0)==" ";)a=a.substring(1,a.length);if(a.indexOf(h)==0)return a.substring(h.length,a.length)}return null};m.Cookie.erase=function(h){m.Cookie.create(h,"",
-1)};m.Cookie.destroy=function(){};i.Booki=m})(window,window.jQuery);
(function(i,m,h,d){d.Booking=function(a){this.init(a);this.destroyDelegate=d.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};d.Booking.SeatMode={perEntireBookingPeriod:0,perDay:1,perIndividualTimeslot:2};d.Booking.prototype.init=function(a){var b=this;a=i.extend({},a);this.$root=i(a.elem);this.projectId=a.projectId;this.defaultDateSelected=a.defaultDateSelected;this.dateFormatString=a.dateFormat;this.altFormat=a.altFormat;this.calendar=a.calendar;this.calendarDays=a.calendarDays;
this.minDate=a.minDate;this.maxDate=a.maxDate;this.currencySymbol=a.currencySymbol;this.currency=a.currency;this.decimalPoint=a.decimalPoint;this.thousandsSep=a.thousandsSep;this.timezone=a.timezone;this.ajaxUrl=a.ajaxurl;this.$daysExhausted=this.$root.find(".booki-days-exhausted");this.$timeSlotsExhausted=this.$root.find(".booki-time-slots-exhausted");this.$timeSlotsBooked=this.$root.find(".booki-time-slots-booked");this.$optionals=this.$root.find(".booki-optional");this.$popupCalendar=this.$root.find(".booki-single-datepicker");
this.$fromPopupCalendar=this.$root.find(".booki-datepicker-from");this.$toPopupCalendar=this.$root.find(".booki-datepicker-to");this.$selectionLimit=this.$root.find(".booki-booking-limit");this.$datePickerMinDateSelection=this.$root.find(".booki-datepicker-min-date-selection");this.$singleDatePickerAddon=this.$root.find(".booki-single-datepicker-group .input-group-addon");this.$selectedDateInput=this.$root.find(".booki-selected-date");this.bookingDaysMinimum=a.bookingDaysMinimum;this.bookingDaysLimit=
a.bookingDaysLimit;this.$totalsLabel=this.$root.find(".booki-totals-label");this.$timeSlotsDropDownList=this.$root.find('select[name="time[]"]');this.$timezoneDropDownList=this.$root.find('select[name="timezone"]');this.$autoDetect=this.$root.find('input[name="autodetect"]');this.bookingMode=a.bookingMode;this.calendarMode=a.calendarMode;this.usedSlots=a.usedSlots;this.autoTimezoneDetection=a.autoTimezoneDetection;this.timeSelector=a.timeSelector;this.discount=a.discount;this.bookingMinimumDiscount=
a.bookingMinimumDiscount;this.bookedItemsCount=a.bookedItemsCount;this.includeBookingPrice=a.includeBookingPrice;this.calendarCssClasses=a.calendarCssClasses;this.calendarFirstDay=a.calendarFirstDay;this.showCalendarButtonPanel=a.showCalendarButtonPanel;this.displayBookedTimeSlots=a.displayBookedTimeSlots;this.$subTotalContainer=this.$root.find(".booki-sub-total");this.$depositContainer=this.$root.find(".booki-deposit");this.$depositLabel=this.$root.find(".booki-deposit-label");this.$subTotalLabel=
this.$root.find(".booki-sub-total-label");this.$discountContainer=this.$root.find(".booki-discount");this.$discountLabel=this.$root.find(".booki-discount-label");this.$optionalsCount=this.$root.find(".booki_optionals_count");this.$progressTimeslots=this.$root.find(".progress.booki-time-progress");this.optionalsBookingMode=a.optionalsBookingMode;this.optionalsListingMode=a.optionalsListingMode;this.optionalsMinimumSelection=a.optionalsMinimumSelection;this.defaultCascadingListSelectionLabel=a.defaultCascadingListSelectionLabel;
this.highlightSelectedOptionals=a.highlightSelectedOptionals;this.$cascadingLists=this.$root.find(".booki-cascading-list");this.$progressCascades=this.$root.find(".progress.booki-progress-cascades");this.hideSelectedDays=a.hideSelectedDays;this.$minimumDaysRequired=this.$root.find(".booki-minimum-days-required");this.$deposit=this.$root.find('input[name="deposit_field"]');this.$bookNowPayLaterButton=this.$root.find('button[name="booki_checkout"][value="0"]');this.$payNowButton=this.$root.find('button[name="booki_checkout"][value="1"]');
this.$addToCartButton=this.$root.find('button[name="booki_add_cart"]');this.$selectedDatesContainer=this.$root.find(".booki-dates");this.$bookingLimitCounterAlert=this.$root.find(".booki-booking-limit-counter-alert");this.$bookingCounterLabel=this.$root.find(".booki-booking-counter");this.bookingLimitLabel=a.bookingLimitLabel;this.quantityElements=a.quantityElements;this.quantityElementsReserved=a.quantityElementsReserved;this.quantityElementsFromCart=a.quantityElementsFromCart;this.$dynamicQuantityElementPlaceholder=
this.$root.find(".booki-dynamic-quantity-element-placeholder");this.quantityElementExhaustedAlertMessage=a.quantityElementExhaustedAlertMessage;this.precision=a.precision;this.currencySymbolPosition=a.currencySymbolPosition;this.selectedQuantityElements=[];this.exhaustedSlots=[];this.timeslotsCache=[];this.currencyFormatString="%s %v";if(this.currencySymbolPosition===1)this.currencyFormatString="%v %s";if(this.currencySymbol)this.currencySymbol=i("<div>").html(this.currencySymbol).text();i(document).ajaxStop(function(){b.$progressTimeslots&&
b.$progressTimeslots.hide();b.$progressCascades&&b.$progressCascades.hide()});this.$autoDetect.on("click",function(){i(this).is(":checked")&&b.getTimeSlots(b.formatDate(b.$selectedDateInput.val()))});this.defaultDateSelected&&this.$selectedDateInput.val(this.formatDate(this.minDate));this.bookingDaysLimit>1&&this.calendar.period===0&&this.$selectedDatesContainer.addClass("booki-outer-border");this.disableBackspaceDelegate=d.createDelegate(this,this.disableBackspace);this.$popupCalendar.on("keydown",
this.disableBackspaceDelegate);this.$fromPopupCalendar.on("keydown",this.disableBackspaceDelegate);this.$toPopupCalendar.on("keydown",this.disableBackspaceDelegate);this.timezoneChangedDelegate=d.createDelegate(this,this.timezoneChanged);this.$timezoneDropDownList.change(this.timezoneChangedDelegate);i(this.usedSlots).each(function(c,e){e.slotsExhausted&&b.exhaustedSlots.push(e.day)});this.timeSlotsChangedDelegate=d.createDelegate(this,this.timeSlotsChanged);this.$timeSlotsDropDownList.change(this.timeSlotsChangedDelegate);
this.cascadingListItemSelectedDelegate=d.createDelegate(this,this.cascadingListItemSelected);this.$cascadingLists.on("change",this.cascadingListItemSelectedDelegate);if(this.datePicker()){this.updateTotalDelegate=d.createDelegate(this,this.updateTotal);this.$optionals.change(this.updateTotalDelegate)}else{this.$optionals.attr("disabled",true);this.$addToCartButton.attr("disabled",true)}this.updateTotal()};d.Booking.prototype.timeSlotsChanged=function(){var a,b=this.bookingDaysLimitCheck(),c=this.$timeSlotsDropDownList.find("option:selected"),
e;if(!b)for(e=0;e<c.length;e++){b=i(c[e]);e>=this.bookingDaysLimit&&b.removeAttr("selected")}for(e=0;e<c.length;e++){b=i(c[e]);a=this.parseTimeslots(b.val());a=this.applySeats(this.currentDate,a,true);a.seatSupport&&!a.hasSeats&&b.removeAttr("selected")}this.updateQuantityElementTimeslot();this.minimumDaysCheck();this.updateTotal()};d.Booking.prototype.parseTimeslots=function(a){var b;b=a.split(",");a=b[0].split(":");b=b[1].split(":");return{hourStart:parseInt(a[0],10),minuteStart:parseInt(a[1],10),
hourEnd:parseInt(b[0],10),minuteEnd:parseInt(b[1],10)}};d.Booking.prototype.bookingDaysLimitCheck=function(a){var b=this.getSelectedDates(),c=true;b=this.calendar.period===0?b.length:this.$timeSlotsDropDownList.find("option:selected").length;if(typeof a!=="undefined")b=a;if(this.bookingDaysLimit>1&&b>this.bookingDaysLimit){this.$selectionLimit.removeClass("hide");c=false}else this.$selectionLimit.addClass("hide");return c};d.Booking.prototype.minimumDaysCheck=function(){var a=this.getSelectedDates(),
b=true;a=this.calendar.period===0?a.length:this.$timeSlotsDropDownList.find("option:selected").length;if(this.bookingDaysMinimum&&a<this.bookingDaysMinimum){b=false;this.$minimumDaysRequired.removeClass("hide");this.commandButtonStatus(true)}else{this.$minimumDaysRequired.addClass("hide");this.commandButtonStatus(false)}b&&this.testAddToCartButton();return b};d.Booking.prototype.getSelectedDates=function(){var a=this.$selectedDateInput.val();return a?a.split(","):[]};d.Booking.prototype.addSelectedDates=
function(a){var b=this.getCost(a),c=h.formatMoney(b,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString),e=this.$selectedDatesContainer.find("li");c=this.includeBookingPrice?'<span class="badge">'+c+"</span>":"";var f='<span class="booki-remove-button-container">',g=this.getSelectedDates(),j=false,k;if(b>0)f+=c;e.each(function(l,n){if(i(n).data("value")===a){j=true;return false}});if(!j){if(this.bookingDaysLimit===1||this.calendar.period===1)this.$selectedDatesContainer.empty();
this.$selectedDatesContainer.append('<li data-value="'+a+'"><span class="pull-left">'+a+"</span>"+f+'<i class="glyphicon glyphicon-trash"></i></span></li>');k=this.$selectedDatesContainer.find('[data-value="'+a+'"]');this.selectedDateRemoveClickDelegate=d.createDelegate(this,this.onSelectedDateRemoveClick);k.find("i").on("click",this.selectedDateRemoveClickDelegate);b=this.$selectedDatesContainer.find('[data-value="'+g[0]+'"] span.booki-remove-button-container');if(b.find("i").length===0){b.append('<i class="glyphicon glyphicon-trash"></i>');
b.find("i").on("click",this.selectedDateRemoveClickDelegate)}window.setTimeout(function(){k.addClass("booki-slide-in")},50)}};d.Booking.prototype.onSelectedDateRemoveClick=function(a){this.selectedDateRemove(i(a.currentTarget).parent().parent().data("value"));this.bookingDaysLimitCheck();this.updateSeatsCounter(this.calendar.period);this.minimumDaysCheck();this.updateTotal()};d.Booking.prototype.selectedDateRemove=function(a){var b,c=this.getSelectedDates(),e,f;for(b=0;b<c.length;b++)if(c[b]===a){c.splice(b,
1);break}if(!this.hideSelectedDays){b=this.$root.find('[data-value="'+a+'"]');b.removeClass("booki-slide-in");(function(g){window.setTimeout(function(){g.remove()},1E3)})(b)}this.$selectedDateInput.val(c.join());if(c.length===0){this.$popupCalendar.datepicker("setDate",null);this.$toPopupCalendar.datepicker("setDate",null);this.$fromPopupCalendar.datepicker("setDate",null)}if(c.length>0){e=this.formatMoment(c[0]);f=this.formatMoment(c[c.length-1]);for(b=0;b<c.length;b++){a=this.formatMoment(c[b]);
if(a.isAfter(f))f=a;if(a.isBefore(e))e=a}(function(g,j,k){window.setTimeout(function(){if(k.$popupCalendar.length>0)k.$popupCalendar.datepicker("setDate",k.formatDate(j));else{k.$fromPopupCalendar.datepicker("setDate",k.formatDate(g));k.$toPopupCalendar.datepicker("setDate",k.formatDate(j))}},50)})(e,f,this)}this.clearQuantityElements(c.length===0);!this.calendar.period&&c.length>0&&this.updateQuantityElements(e);this.defaultDateSelected||this.$selectedDateInput.parsley().validate(true)};d.Booking.prototype.testAddToCartButton=
function(){var a=!this.$selectedDateInput.val();this.commandButtonStatus(a);return!a};d.Booking.prototype.formatDate=function(a){return(m.isMoment(a)?a:m(this.stringToDate(a))).format(this.dateFormatString)};d.Booking.prototype.formatMoment=function(a){return m.isMoment(a)?a:m(this.stringToDate(a),this.dateFormatString)};d.Booking.prototype.stringToDate=function(a){if(a instanceof Date&&!isNaN(a.valueOf()))return a;var b=this.dateFormatString,c=b.toLowerCase();b=this.parseDelimiter(b);c=c.split(b);
a=a.split(b);var e=c.indexOf("mm");b=c.indexOf("dd");c=c.indexOf("yyyy");e=parseInt(a[e],10);e-=1;return new Date(a[c],e,a[b])};d.Booking.prototype.parseDelimiter=function(a){if(a.indexOf("/")!==-1)return"/";else if(a.indexOf(".")!==-1)return".";else if(a.indexOf("-")!==-1)return"-"};d.Booking.prototype.calculateSelectedDaysCost=function(){var a=this.getSelectedDates(),b=a.length,c,e,f=0;for(e=0;e<b;e++){c=a[e];f+=this.getCost(c)}return f};d.Booking.prototype.getCost=function(a){var b,c=this.calendarDays.length,
e;for(b=0;b<c;b++){e=this.calendarDays[b];if(a===e.day)return this.parseDouble(e.cost)}return this.parseDouble(this.calendar.cost)};d.Booking.prototype.updateSeatsCounter=function(a){var b=this.getSelectedDates(),c,e,f,g=[];if(a===0)for(a=0;a<b.length;a++){e=b[a];c=this.applySeats(e);if(c.seatSupport){c=this.bookingLimitLabel.replace("%d",c.count);g.push('<div class="booki-booking-count-item"><strong>'+e+"</strong>: <span>"+c+"</span></div>")}}else{b=this.$timeSlotsDropDownList.find("option:selected");
e=this.currentDate;for(a=0;a<b.length;a++){f=i(b[a]);c=this.parseTimeslots(f.val());c=this.applySeats(e,c);if(c.seatSupport){c=this.bookingLimitLabel.replace("%d",c.count);g.push('<div class="booki-booking-count-item"><strong>'+e+", <i>"+f.text()+"</i></strong>: <span>"+c+"</span></div>")}}}if(g.length>0){this.$bookingLimitCounterAlert.removeClass("hide");this.$bookingCounterLabel.html(g.join(""))}};d.Booking.prototype.applySeats=function(a,b,c){var e,f=null,g=this.calendar.seats,j=null,k=null,l;
for(e=0;e<this.calendarDays.length;e++){l=this.calendarDays[e];if(l.day==a){j=l.seatMode;k=l.bookingLimit;break}}if(j===null){j=this.calendar.seatMode;k=this.calendar.bookingLimit}if(k===0||j===0)return{hasSeats:true,count:k,seatSupport:k>0};for(e=0;e<g.length;e++){l=g[e];if(j===1){if(l.bookingDate==a){f=k-l.bookedDaysCount;break}}else if(this.calendar.seatMode===2&&b)if(l.bookingDate==a&&l.hourStart==b.hourStart&&l.minuteStart==b.minuteStart&&l.hourEnd==b.hourEnd&&l.minuteEnd==b.minuteEnd){f=k-l.timeslotsCount;
break}}if(f===null)f=k;c&&this.updateSeatsCounter(this.calendar.period);return{hasSeats:f>0,count:f,seatSupport:k>0}};d.Booking.prototype.updateTotal=function(){if(this.includeBookingPrice){var a=0,b=this.$timeSlotsDropDownList.find("option:selected").length,c=this.getSelectedDates(),e=this.calculateSelectedDaysCost(),f=this.discount>0&&(this.bookedItemsCount>=this.bookingMinimumDiscount||this.bookingMinimumDiscount===0);c=this.timeSelector===1&&b>1?b:c.length;var g=this.applyDeposit();c||(c=1);a+=
this.cascadingItemsTotal(c);a+=this.optionalsTotal(c);a+=this.getQuantityElementsTotalCost();if(this.timeSelector===1&&b>1)e*=b;this.ensureTimeSlotSelection();a+=e;if(f||g>0){this.$subTotalContainer.removeClass("hide");this.$subTotalLabel.html(h.formatMoney(a,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString))}else this.$subTotalContainer.addClass("hide");if(f){this.$discountContainer.removeClass("hide");this.$discountLabel.html(-this.discount+"%");a-=
this.discount/100*a}else this.$discountContainer.addClass("hide");if(g>0){b=a/100*g;a-=b;this.$depositContainer.removeClass("hide");this.$depositLabel.html(h.formatMoney(b,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString))}else this.$depositContainer.addClass("hide");this.$totalsLabel.html(h.formatMoney(a,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString));a>0?this.$payNowButton.removeAttr("disabled"):this.$payNowButton.attr("disabled",
true)}};d.Booking.prototype.cascadingItemsTotal=function(a){var b,c=0,e,f,g,j,k=this.$root.find(".booki-cascading-list option");for(b=0;b<k.length;b++){e=i(k[b]);f=this.parseDouble(e.data("bookiCost"));g=parseInt(e.data("bookiParent"),10);j=e.data("bookiOriginalValue");if(f!==0&&!isNaN(f)&&g===-1){if(this.optionalsBookingMode===1){f*=a;g=h.formatMoney(f,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString);e.html(j+"&nbsp;&nbsp;x "+a+" = "+g)}if(e.is(":selected"))c+=
f}}return c};d.Booking.prototype.optionalsTotal=function(a){var b,c=0,e,f,g,j;for(b=0;b<this.$optionals.length;b++){e=i(this.$optionals[b]);f=this.parseDouble(e.data("cost"));g=i(e.parent());j=g.find(".booki_optionals_cost");if(this.optionalsBookingMode===1){f*=a;this.$optionalsCount.html(" x "+a)}if(e.is(":checked")){c+=f;this.highlightSelectedOptionals&&g.addClass("active")}else this.highlightSelectedOptionals&&g.removeClass("active");e=h.formatMoney(f,this.currencySymbol,this.precision,this.thousandsSep,
this.decimalPoint,this.currencyFormatString);j.html(e)}return c};d.Booking.prototype.allowAdvanceBooking=function(a){a=this.formatMoment(a);var b=m();a=Math.round(this.minutesDiff(b._d,a._d));if(this.calendar.bookingStartLapse!==0&&a<this.calendar.bookingStartLapse)return false;return true};d.Booking.prototype.bookingDateAvailable=function(a){a=this.formatMoment(a);var b=m();a=a.hours(b.hours()).minutes(b.minutes());b=b.minutes(this.calendar.bookingStartLapse);if(a<b&&!a.isSame(b,"day"))return false;
return true};d.Booking.prototype.minutesDiff=function(a,b){return(b.getTime()-a.getTime())/6E4};d.Booking.prototype.isValidDay=function(a){var b=true,c=this.formatMoment(a).weekday();if(!this.bookingDateAvailable(a))return false;if(!this.applySeats(a).hasSeats||!this.containsQuantity(this.formatMoment(a)))return false;i(this.calendar.daysExcluded).each(function(e,f){if(f===a)return b=false});this.bookingMode===1&&i(this.usedSlots).each(function(e,f){if(f.day===a&&f.slotsExhausted)return b=false});
i(this.calendar.weekDaysExcluded).each(function(e,f){if(c===f)return b=false});return b};d.Booking.prototype.beforeShowDay=function(a){a.getDay();var b=this.getSelectedDates(),c=false,e=this.formatDate(a);if(!this.isValidDay(e))return[false];i(b).each(function(f,g){if(e===g){c=true;return false}});if(c){if(this.calendarMode===0||this.calendarMode===1){!this.hideSelectedDays&&this.defaultDateSelected&&this.addSelectedDates(e);this.calendar.period===1&&this.$timeSlotsDropDownList.find("options").length>
0&&this.getTimeSlots(e)}return[true," highlighted-day",".."]}return[true,e,""]};d.Booking.prototype.dateSelected=function(a){var b=this.getSelectedDates(),c=b.length,e='<i class="glyphicon glyphicon-calendar"></i>';this.currentDate=a;this.selectedQuantityElements.length=0;this.clearQuantityElements();this.calendar.period?this.getTimeSlots(a):this.updateQuantityElements(this.formatMoment(a));if(i.inArray(a,b)!==-1){this.selectedDateRemove(a);this.bookingDaysLimitCheck()}else if(this.bookingDaysLimit<=
1||this.calendar.period===1){this.$selectedDateInput.val(a);if(this.includeBookingPrice){b=this.getCost(a);if(b>0)e=h.formatMoney(b,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString);this.$singleDatePickerAddon.html(e)}}else if(c<this.bookingDaysLimit){b.push(a);this.$selectedDateInput.val(b.join());this.hideSelectedDays||this.addSelectedDates(a)}else if(c>0){(function(f,g,j){window.setTimeout(function(){j.$popupCalendar.datepicker("setDate",f[g-1])},
50)})(b,c,this);c===this.bookingDaysLimit&&this.$selectionLimit.removeClass("hide")}a=this.applySeats(a,null,true);a.seatSupport&&this.commandButtonStatus(!a.hasSeats);if(!a.seatSupport||a.hasSeats)this.minimumDaysCheck();this.updateTotal();this.defaultDateSelected||this.$selectedDateInput.parsley().validate(true)};d.Booking.prototype.disableBackspace=function(a){a.keyCode===8&&a.preventDefault()};d.Booking.prototype.adjustByAvailability=function(a){var b=this,c,e,f,g;this.usedSlots.sort(function(j,
k){return b.formatMoment(j.day)-b.formatMoment(k.day)});for(g=0;g<this.usedSlots.length;g++){c=this.usedSlots[g];e=this.formatMoment(c.day);f=a.diff(e,"days");if(a.isBefore(e)&&f===1||a.isSame(e))if(c.slotsExhausted)a=a.add("days",1)}return a};d.Booking.prototype.applyDeposit=function(){var a=this,b=this.getSelectedDates(),c,e,f,g,j=m(),k,l;b.sort(function(n,o){return a.formatMoment(n)-a.formatMoment(o)});for(e=0;e<b.length;e++){c=b[e];for(f=0;f<this.calendarDays.length;f++){k=this.calendarDays[f];
if(c===k.day){g=this.formatMoment(k.day);g=g.diff(j,"days");if(g>k.minNumDaysDeposit){l=k.deposit;break}}}if(l>0)break}if(!l){if(b.length>0){g=this.formatMoment(b[0]);g=g.diff(j,"days")}if(this.calendar.minNumDaysDeposit===0||g>this.calendar.minNumDaysDeposit)l=this.calendar.deposit}this.$deposit.val(l);return l};d.Booking.prototype.datePicker=function(){var a=this,b,c=this.formatMoment(this.minDate),e=this.formatMoment(this.maxDate),f='<i class="glyphicon glyphicon-calendar"></i>';for(this.adjustByAvailability(c);(c.isBefore(e)||
c.isSame(e))&&this.calendar.weekDaysExcluded.indexOf(c.weekday())>-1;){c.add("days",1);this.adjustByAvailability(c)}for(this.calendar.daysExcluded.sort(function(g,j){return a.formatMoment(g)-a.formatMoment(j)});(c.isBefore(e)||c.isSame(e))&&this.calendar.daysExcluded.indexOf(this.formatDate(c))>-1;){c.add("days",1);this.adjustByAvailability(c)}for(;!this.bookingDateAvailable(this.formatDate(c))&&c.isBefore(e);){c.add("days",1);this.adjustByAvailability(c)}for(;!this.containsQuantity(c)&&c.isBefore(e);)c.add("days",
1);if(c.isAfter(e)){this.$selectedDateInput.val("");this.commandButtonStatus(true);this.$daysExhausted.removeClass("hide");this.$timeSlotsExhausted.removeClass("hide");this.$bookingLimitCounterAlert.addClass("hide");this.$popupCalendar.addClass("booki-readonly-field");this.$fromPopupCalendar.addClass("booki-readonly-field");this.$toPopupCalendar.addClass("booki-readonly-field");this.$timeSlotsDropDownList.attr("disabled",true);this.includeBookingPrice&&this.defaultDateSelected&&this.$singleDatePickerAddon.html(f);
return false}this.currentDate=b=this.formatDate(c);if(this.defaultDateSelected||this.calendarMode===4)this.$selectedDateInput.val(b);this.beforeShowDayDelegate=d.createDelegate(this,this.beforeShowDay);e={dateFormat:this.altFormat,defaultDate:c._d,minDate:c._d,maxDate:e._d,beforeShowDay:this.beforeShowDayDelegate,hideIfNoPrevNext:true,showButtonPanel:this.showCalendarButtonPanel};if(this.calendarFirstDay<7)e.firstDay=this.calendarFirstDay;if(this.$popupCalendar.length>0){this.dateSelectedDelegate=
d.createDelegate(this,this.dateSelected);e.onSelect=this.dateSelectedDelegate;e.onClose=function(){a.$popupCalendar.parsley().validate(true)};this.$popupCalendar.datepicker(e);if(this.includeBookingPrice&&this.defaultDateSelected){c=this.getCost(b);if(c>0)f=h.formatMoney(c,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatStringt);this.$singleDatePickerAddon.html(f)}if(this.defaultDateSelected){this.$popupCalendar.datepicker("setDate",b);this.calendar.period===
1&&this.getTimeSlots(b)}this.calendarCssClasses&&this.$popupCalendar.addClass(this.calendarCssClasses)}if(this.$fromPopupCalendar.length>0){e.onClose=function(g){var j=a.getSelectedDates();a.$toPopupCalendar.length>0&&a.$toPopupCalendar.datepicker("option","minDate",g);j.length>0&&a.onRangeClose();a.$fromPopupCalendar.parsley().validate(true)};this.$fromPopupCalendar.datepicker(e);this.defaultDateSelected&&this.$fromPopupCalendar.datepicker("setDate",b);this.calendarCssClasses&&this.$fromPopupCalendar.addClass(this.calendarCssClasses)}if(this.$toPopupCalendar.length>
0){e.onClose=function(g){a.$fromPopupCalendar.length>0&&a.$fromPopupCalendar.datepicker("option","maxDate",g);a.onRangeClose();a.$toPopupCalendar.parsley().validate(true)};this.$toPopupCalendar.datepicker(e);this.defaultDateSelected&&this.$toPopupCalendar.datepicker("setDate",b);this.calendarCssClasses&&this.$toPopupCalendar.addClass(this.calendarCssClasses)}if(this.defaultDateSelected){this.addDatesFromRange();this.calendar.period===0&&this.updateQuantityElements(this.formatMoment(this.currentDate))}b=
this.applySeats(this.currentDate,null,this.defaultDateSelected);b.seatSupport&&this.commandButtonStatus(!b.hasSeats);if(!b.seatSupport||b.hasSeats)this.minimumDaysCheck();this.calendarCssClasses&&i("#ui-datepicker-div").addClass(this.calendarCssClasses);return true};d.Booking.prototype.commandButtonStatus=function(a){if(a){this.$addToCartButton.attr("disabled",a);this.$bookNowPayLaterButton.attr("disabled",a);this.$payNowButton.attr("disabled",a)}else{this.$addToCartButton.removeAttr("disabled");
this.$bookNowPayLaterButton.removeAttr("disabled");this.$payNowButton.removeAttr("disabled")}};d.Booking.prototype.onRangeClose=function(){this.addDatesFromRange()};d.Booking.prototype.timezoneChanged=function(a){a=i(a.currentTarget).find(":selected").val();this.getTimeSlots(this.currentDate,a);this.timezone=a};d.Booking.prototype.getTimeSlots=function(a,b){var c,e=this.calendarDays.length,f,g,j,k,l,n,o,p,r,q;this.currentDate=a;this.$timeSlotsBooked.addClass("hide");if(typeof b==="undefined"){c=d.TimezoneControlState.readState();
b=c.selectedZone;if(!this.autoTimezoneDetection)b=this.timezone}j=this.calendar.hours;k=this.calendar.minutes;l=this.calendar.hourStartInterval;n=this.calendar.minuteStartInterval;g=this.calendar.timeExcluded;for(c=0;c<e;c++){f=this.calendarDays[c];if(f.day==a){j=f.hours;k=f.minutes;l=f.hourStartInterval;n=f.minuteStartInterval;g=f.timeExcluded;break}}if(j===o&&k===p&&l===r&&n===q&&this.timezone===b)this.renderTimeslots(g);else{o=j;p=k;r=l;q=n;this.timezone=b;this.$progressTimeslots.removeClass("hide");
this.$progressTimeslots.show();(function(u,v,s){i.post(s.ajaxUrl,{model:v,action:"booki_getTimeSlots"},function(t){t=i.parseJSON(t).result;s.timeslotsCache=t?t.timeslots:[];s.timeslotsCache.length!==0&&s.renderTimeslots(u)})})(g,{hours:j,minutes:k,hourStartInterval:l,minuteStartInterval:n,enableSingleHourMinuteFormat:this.calendar.enableSingleHourMinuteFormat,timezone:this.timezone},this)}};d.Booking.prototype.renderTimeslots=function(a){var b,c,e,f,g=this.timeslotsCache.length,j=m(),k=[],l,n;this.$timeSlotsDropDownList.empty();
this.$timeSlotsDropDownList.prop("disabled",false);for(b=0;b<g;b++){n=true;l=this.timeslotsCache[b].value;c=l.split(",");e="";if(a.indexOf(c[0])!==-1){if(!this.displayBookedTimeSlots)continue;e=' disabled class="booki-option-disabled"'}k.push(this.timeslotsCache[b]);f=this.timeslotsCache[b].rawFrom.split(":");f=this.formatMoment(this.currentDate).hour(f[0]).minute(f[1]);if(!(f<j)){l=this.parseTimeslots(l);if(this.containsQuantity(this.formatMoment(this.currentDate),l)){l=this.applySeats(this.currentDate,
l,true);if(l.seatSupport&&!l.hasSeats)n=false;if(this.allowAdvanceBooking(f)&&n){c='<option value="'+c+'"'+e+">"+this.timeslotsCache[b].text+"</option>";this.$timeSlotsDropDownList.append(c)}}}}if(this.timeslotsEmpty()){this.$timeSlotsDropDownList.prop("disabled",true);this.$timeSlotsBooked.removeClass("hide");this.$bookingLimitCounterAlert.addClass("hide");this.commandButtonStatus(true)}this.ensureTimeSlotSelection();this.updateQuantityElementTimeslot();this.updateSeatsCounter(this.calendar.period)};
d.Booking.prototype.timeslotsEmpty=function(){return this.$timeSlotsDropDownList.find("option").length===0||this.$timeSlotsDropDownList.find("option:not(:disabled)").length===0};d.Booking.prototype.ensureTimeSlotSelection=function(){var a;if(!(this.$timeSlotsDropDownList.find("option[selected]").length>0)){a=this.$timeSlotsDropDownList.find("option").not("[disabled]");a.length>0&&i(a[0]).attr("selected",true)}};d.Booking.prototype.updateQuantityElementTimeslot=function(){var a,b;a=this.$timeSlotsDropDownList.find("option:selected");
if(a.length>0)b=i(a[0]).val();b&&this.updateQuantityElements(this.formatMoment(this.currentDate),this.parseTimeslots(b))};d.Booking.prototype.addDatesFromRange=function(){var a=[],b,c=this.formatMoment(this.currentDate);b=this.formatMoment(this.currentDate);var e,f;if(this.calendarMode===2||this.calendarMode===3){if(this.$fromPopupCalendar.length>0)c=m(this.$fromPopupCalendar.datepicker("getDate"));if(this.$toPopupCalendar.length>0)b=m(this.$toPopupCalendar.datepicker("getDate"))}else if(this.bookingDaysLimit>
1&&this.calendar.period===0){if(this.$toPopupCalendar.length>0)b=m(this.$toPopupCalendar.datepicker("getDate"))}else return;if(c&&b){e=this.calendarMode===3?b.diff(c,"days"):b.diff(c,"days")+1;e=this.validateRangeDiff(c,e);if(this.bookingDaysLimitCheck(e)){this.$selectedDatesContainer.empty();if(e===0&&this.calendarMode===3){b=c.format(this.dateFormatString);this.isValidDay(b)&&a.push(b)}else{c=c.subtract(1,"day");for(f=0;f<e;f++){c=c.add(1,"day");b=c.format(this.dateFormatString);this.calendar.weekDaysExcluded.indexOf(c.weekday())>
-1||this.calendar.daysExcluded.indexOf(b)>-1||this.exhaustedSlots.indexOf(b)>-1||this.isValidDay(b)&&a.push(b)}}this.$selectedDateInput.val(a.join());if(!this.hideSelectedDays)for(f=0;f<a.length;f++)this.addSelectedDates(a[f]);this.updateQuantityElements(c);this.minimumDaysCheck();this.updateTotal()}else{a=this.getSelectedDates();b=a[a.length-1];this.$toPopupCalendar.datepicker("setDate",b);this.$toPopupCalendar.datepicker("option","minDate",b)}}};d.Booking.prototype.validateRangeDiff=function(a,
b){var c,e,f=0;a=a.clone().subtract(1,"day");for(c=0;c<b;c++){a=a.add(1,"day");e=a.format(this.dateFormatString);this.calendar.weekDaysExcluded.indexOf(a.weekday())>-1||this.calendar.daysExcluded.indexOf(e)>-1||this.exhaustedSlots.indexOf(e)>-1||++f}return f};d.Booking.prototype.cascadingListItemSelected=function(a){a=a.currentTarget;var b=i("option:selected",a),c=parseInt(b.val(),10),e=b.data("bookiParent");b=b.data("bookiList");var f=this.$root.find("booki_cascadingdropdown_"+e),g=i(a).data("bookiPlaceholder");
this.updateTotal();if(isNaN(c))this.clearCascadingList(c,a);else if(!(typeof e!=="number"||f.length>0))if(e!==-1){this.$progressCascades.removeClass("hide");this.$progressCascades.show();(function(j,k,l,n,o,p,r){i.post(r.ajaxUrl,{model:j,action:"booki_readCascadingItemsByListId"},function(q){q=i.parseJSON(q);r.createCascadingList(q,k,l,n,o,p)})})({id:e},a,e,b,c,g,this)}};d.Booking.prototype.createCascadingList=function(a,b,c,e,f,g){var j,k=a.cascadingItems,l="booki_cascadingdropdown_"+a.id,n=this.getFormGroup(l,
a.label),o="#"+l+"_container",p;l=i("<select></select>").attr({id:l,name:l,"data-booki-list":e,"data-booki-placeholder":g}).addClass("form-control booki-cascading-list booki_parsley_validated");if(a.isRequired){l.attr("data-parsley-trigger","change");l.attr("data-parsley-required",true)}j=i("<option></option>").attr("value","").html(this.defaultCascadingListSelectionLabel);l.append(j);if(!this.$selectLists)this.$selectLists=[];for(a=0;a<k.length;a++){j=k[a];p=j.value;if(j.cost>0&&j.parentId===-1)p+=
"&nbsp;&nbsp;"+h.formatMoney(j.cost,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString);j=i("<option></option>").attr({value:j.id,"data-booki-parent":j.parentId,"data-booki-cost":j.cost,"data-booki-original-value":j.value,"data-booki-list":e}).html(p);l.append(j)}i(g).append(i("<div></div>").attr({id:"booki_"+c+"_"+e+"_"+f}).append(n));this.clearCascadingList(f,b);i(o).append(l);this.cascadingListItemSelectedDelegate=d.createDelegate(this,this.cascadingListItemSelected);
l.on("change",this.cascadingListItemSelectedDelegate);this.$selectLists.push(l);this.updateTotal()};d.Booking.prototype.clearCascadingList=function(a,b){var c,e,f=i("option",b),g,j;for(c=0;c<f.length;c++){g=i(f[c]);e=parseInt(g.val(),10);j=g.data("bookiParent");g=g.data("bookiList");if(e!==a){g=i("#booki_"+j+"_"+g+"_"+e);if(g.length>0){this.clearCascadingList(e,g[0]);for(c=0;c<this.$selectLists.length;c++){e=this.$selectLists[c];if(e.is('[id="booki_cascadingdropdown_'+j+'"]')){this.$selectLists.splice(c,
1);window.console.log("removed:"+c);break}}g.remove()}}}};d.Booking.prototype.attachQuantityElementDelegates=function(a,b){var c=this.getQuantityElementIndex(b),e;if(!this.$quantityElements)this.$quantityElements=[];this.$quantityElements.push(a);e=d.createDelegate(this,this.quantityElementChanged);a.change(e);b.isRequired&&b.displayMode===0&&i.trim(a.val())!==""&&this.selectedQuantityElements.push(c)};d.Booking.prototype.detachQuantityElementDelegates=function(a,b){var c=this.getQuantityElementIndex(b),
e,f=null;if(c!==-1)for(e=0;e<this.selectedQuantityElements.length;e++)if(this.selectedQuantityElements[e]===c){this.selectedQuantityElements.splice(e,1);break}for(e=0;e<this.$quantityElements.length;e++)if(this.$quantityElements[e]==a){f=e;break}f!==null&&this.$quantityElements.splice(f,1);a.off();this.$root.find(".booki_quantity_element_exhausted_alert_"+b.id).remove();this.$root.find(".form-group.booki_quantity_element_"+b.id).remove()};d.Booking.prototype.getQuantityElementIndex=function(a){var b,
c=this.quantityElements.length,e;for(b=0;b<c;b++){e=this.quantityElements[b];if(e.id===a.id)return b}return-1};d.Booking.prototype.calendarDayHasQuantityElement=function(a,b){var c,e;if(!b)b=this.currentDate;for(c=0;c<this.calendarDays.length;c++){e=this.calendarDays[c];if(a.calendarDayIdList.indexOf(e.id)!==-1)if(e.day==b)return true}return false};d.Booking.prototype.getQuantityElementsTotalCost=function(){var a,b,c,e,f,g,j=0,k=this.getSelectedDates(),l=this.$timeSlotsDropDownList.find("option:selected");
for(a=0;a<this.selectedQuantityElements.length;a++){c=this.quantityElements[this.selectedQuantityElements[a]];f=c.displayMode;g=f===0?"select":"input";b=this.$root.find(g+'[name="booki_quantity_element_'+c.id+'"]');g=parseInt(i.trim(b.val()),10);b=b[0].type;if(f===1)if(g>c.quantity||g<=0)continue;f=c.cost;if(b==="text")g-=1;for(b=0;b<c.quantityElementItems.length;b++){e=c.quantityElementItems[b];if(e.quantityIndex===g){f=e.cost;break}}j+=f}if(k.length>0)j*=k.length;else if(l.length>0)j*=l.length;
return j};d.Booking.prototype.quantityElementChanged=function(a){var b=i(a.currentTarget);a=i.trim(b.val());var c=parseInt(a,10),e=parseInt(b.attr("data-booki-quantity-element-id"),10);if(b[0].type==="text")c-=1;for(b=0;b<this.quantityElements.length;b++)if(this.quantityElements[b].id===e){if(a===""||isNaN(c))this.selectedQuantityElements.splice(this.selectedQuantityElements.indexOf(b),1);else this.selectedQuantityElements.indexOf(b)===-1&&this.selectedQuantityElements.push(b);break}this.updateTotal()};
d.Booking.prototype.containsQuantity=function(a,b){var c,e,f;if(!this.calendar.availabilityByQuantityElement||this.quantityElements.length===0)return true;e=this.getAvailableQuantityElement(true,this.quantityElementsReserved,a,b);if(!e)for(c=0;c<this.quantityElements.length;c++){f=this.syncQuantityElementsFromCart(this.shallowCloneQuantity(this.quantityElements[c]),a,b);if(f.quantity<=0){e=f;break}}if(e)return e.quantity>0;return true};d.Booking.prototype.getAvailableQuantityElement=function(a,b,
c,e){var f,g=null,j;for(f=0;f<b.length;f++){j=b[f];if(j.bookingMode!==3){a=this.formatMoment(j.bookingDate).isSame(c)||this.calendarDayHasQuantityElement(j,this.formatDate(c));if(!(j.bookingMode!==0&&!a)){if(j.bookingMode===1){g=j;break}if(j.bookingMode===2&&e)if(this.isSameTime(e,j)){g=j;break}}}}if(g)g=this.syncQuantityElementsFromCart(this.shallowCloneQuantity(g),c,e);return g};d.Booking.prototype.updateQuantityElements=function(a,b){var c,e,f,g=[];for(c=0;c<this.quantityElementsReserved.length;c++){e=
this.quantityElementsReserved[c];if(e.bookingMode!==3){if(e.bookingMode!==0){f=this.formatMoment(e.bookingDate);if(!f.isSame(a))continue}if(e.bookingMode===2)if(!this.isSameTime(b,e))continue;e=this.syncQuantityElementsFromCart(this.shallowCloneQuantity(e),a,b);this.updateQuantityElementData(e);g.push(e.id)}}for(c=0;c<this.quantityElements.length;c++){e=this.quantityElements[c];if(g.indexOf(e.id)===-1){e=this.syncQuantityElementsFromCart(this.shallowCloneQuantity(e),a,b);this.updateQuantityElementData(e,
c)}}g.length=0};d.Booking.prototype.getQuantityElementItems=function(a){var b,c;for(b=0;b<this.quantityElements.length;b++){c=this.quantityElements[b];if(c.id===a)return c.quantityElementItems}return null};d.Booking.prototype.isSameTime=function(a,b){if(!a||!b)return false;return a.hourStart==b.hourStart&&a.minuteStart==b.minuteStart&&a.hourEnd==b.hourEnd&&a.minuteEnd==b.minuteEnd};d.Booking.prototype.clearQuantityElements=function(a){var b=this.quantityElements.length,c,e;if(!(!a&&this.quantityElementMode()===
0))for(a=0;a<b;a++){c=this.quantityElements[a];e=c.displayMode===0?"select":"input";e=this.$root.find(e+'[name="booki_quantity_element_'+c.id+'"]');e.length>0&&this.detachQuantityElementDelegates(e,c)}};d.Booking.prototype.quantityElementMode=function(){var a,b=this.quantityElements.length,c;if(this.calendar.quantityElementMode===0)return 0;for(a=0;a<b;a++){c=this.quantityElements[a];if(typeof c.calendarDayId!=="undefined"&&c.calendarDayId!==null)if(this.calendarDayHasQuantityElement(c))return 1}return 0};
d.Booking.prototype.shallowCloneQuantity=function(a){var b,c={};for(b in a)if(a.hasOwnProperty(b))c[b]=a[b];return c};d.Booking.prototype.syncQuantityElementsFromCart=function(a,b,c){var e,f,g,j;this.getSelectedDates();var k=this.$timeSlotsDropDownList.find("option:selected");for(e=0;e<this.quantityElementsFromCart.length;e++){f=this.quantityElementsFromCart[e];if(a.id===f.id)if(a.bookingMode!==3){if(a.bookingMode!==0){g=this.formatMoment(b);j=this.formatMoment(f.bookingDate);if(!g.isSame(j))continue}if(a.bookingMode===
2)if(!this.isSameTime(c,f))continue;f=f.quantityCount;if(this.timeSelector!==0&&this.calendar.period===1)f*=k.length;a.quantity-=f}}return a};d.Booking.prototype.updateQuantityElementData=function(a){var b,c,e,f,g;c=this.quantityElementMode();g=a.quantityElementItems?a.quantityElementItems:this.getQuantityElementItems(a.id);var j,k;e=a.displayMode;b=e===0?"select":"input";f=this.$root.find(b+'[name="booki_quantity_element_'+a.id+'"]');if(typeof a.calendarDayId!=="undefined"&&a.calendarDayId!==null)if(f.length===
0)if(this.calendarDayHasQuantityElement(a))f=this.createQuantityElement(e,b,a);else return;else{if(f.length>0&&!this.calendarDayHasQuantityElement(a)){this.detachQuantityElementDelegates(f,a);return}}else if(c===1)return;if(f.length===0)f=this.createQuantityElement(e,b,a);if(e===0){f.empty();i("<option />",{val:"",text:"--"}).appendTo(f);for(b=0;b<a.quantity;b++){k=b+1;if(this.calendar.includePriceInQuantityElement&&a.cost>0){j=a.cost;if(g&&g.length>0)for(c=0;c<g.length;c++)if(g[c].quantityIndex===
b){j=g[c].cost;break}k+=" - ("+h.formatMoney(j,this.currencySymbol,this.precision,this.thousandsSep,this.decimalPoint,this.currencyFormatString)+")"}i("<option />",{val:b,text:k}).appendTo(f)}}else{g=this.$root.find(".input-group-addon.booki_quantity_element_"+a.id);g.html(a.quantity);f.attr("data-parsley-max",a.quantity)}f.removeAttr("disabled");if(a.isRequired&&a.quantity>0){e===1&&f.attr("data-parsley-min",1);f.attr("data-parsley-required",true)}else{f.removeAttr("data-parsley-required");f.removeAttr("data-parsley-min")}e=
this.$root.find(".booki_quantity_element_exhausted_alert_"+a.id);if(a.quantity<=0||this.calendar.period===1&&this.timeslotsEmpty()){f.attr("disabled",true);e.removeClass("hide")}else e.addClass("hide")};d.Booking.prototype.createQuantityElement=function(a,b,c){a===0?this.$dynamicQuantityElementPlaceholder.append(this.getQuantityElementSelectListTemplate(c)):this.$dynamicQuantityElementPlaceholder.append(this.getQuantityElementTextboxTemplate(c));a=this.$root.find(b+'[name="booki_quantity_element_'+
c.id+'"]');this.attachQuantityElementDelegates(a,c);return a};d.Booking.prototype.getQuantityElementSelectListTemplate=function(a){return'<div class="form-group booki_quantity_element_exhausted_alert_'+a.id+' hide"><div class="col-lg-8 col-lg-offset-4"><div class="bg-warning booki-bg-box">'+this.quantityElementExhaustedAlertMessage.replace("%s",a.name)+'</div></div></div><div class="form-group booki_quantity_element_'+a.id+'"><label class="col-lg-4 control-label" for="booki_quantity_element_'+a.id+
'">'+a.name+'</label><div class="col-lg-8"><select class="form-control" name="booki_quantity_element_'+a.id+'" data-booki-quantity-element-id="'+a.id+'"></select></div></div>'};d.Booking.prototype.getQuantityElementTextboxTemplate=function(a){return'<div class="form-group booki_quantity_element_exhausted_alert_'+a.id+' hide"><div class="col-lg-8 col-lg-offset-4"><div class="bg-warning booki-bg-box">'+this.quantityElementExhaustedAlertMessage.replace("%s",a.name)+'</div></div></div><div class="form-group booki_quantity_element_'+
a.id+'"><label class="col-lg-4 control-label" for="booki_quantity_element_'+a.id+'">'+a.name+'</label><div class="col-lg-8"><div class="input-group"><input type="text" class="form-control" name="booki_quantity_element_'+a.id+'" data-booki-quantity-element-id="'+a.id+'" placeholder="0" data-parsley-trigger="change" data-parsley-errors-container=".booki-quantityelement-error-'+a.id+"-"+a.projectId+'" data-parsley-type="digits" /><div class="clearfix"></div><div class="booki-quantityelement-error-'+
a.id+"-"+a.projectId+'"></div></div></div></div>'};d.Booking.prototype.getFormGroup=function(a,b){var c='<div class="form-group">';c+='<label class="col-lg-4 control-label" for="'+a+'">';c+=b;c+="</label>";c+='<div class="col-lg-8">';c+='<div id="'+a+'_container"></div>';c+="</div>";c+="</div>";return c};d.Booking.prototype.parseDouble=function(a){return parseFloat((""+a).replace(/,/g,""))};d.Booking.prototype.checkSeatAvailability=function(a,b,c,e,f){(function(g,j){i.post(g.ajaxUrl,{model:j,action:"booki_seatAvailable"},
function(k){k=i.parseJSON(k).result;window.console.log(k)})})(this,{bookingDate:a,projectId:this.projectId,hourStart:b,minuteStart:c,hourEnd:e,minuteEnd:f})};d.Booking.prototype.destroy=function(){var a;if(this.disableBackspaceDelegate){this.$popupCalendar.off("keydown");this.$fromPopupCalendar.off("keydown");this.$toPopupCalendar.off("keydown");delete this.disableBackspaceDelegate}if(this.timezoneChangedDelegate){this.$timezoneDropDownList.off();delete this.timezoneChangedDelegate}if(this.updateTotalDelegate){this.$optionals.off();
delete this.updateTotalDelegate}if(this.timeSlotsChangedDelegate){this.$timeSlotsDropDownList.off();delete this.timeSlotsChangedDelegate}if(this.selectedDateRemoveClickDelegate){a=this.$selectedDatesContainer.find("li");a.each(function(b,c){i(c).off()});delete this.selectedDateRemoveClickDelegate}this.beforeShowDayDelegate&&delete this.beforeShowDayDelegate;this.dateSelectedDelegate&&delete this.dateSelectedDelegate;if(this.cascadingListItemSelectedDelegate){this.$cascadingLists.off();if(this.$selectLists){for(a=
0;a<this.$selectLists.length;a++)this.$selectLists[a].off();this.$selectLists.length=0}delete this.cascadingListItemSelectedDelegate}if(this.$quantityElements)for(a=0;a<this.$quantityElements.length;a++)this.$quantityElements[a].off();if(this.destroyDelegate){i(window).off("unload",this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.moment,window.accounting,window.Booki);
(function(i,m,h){h.BookingWizard=function(d){this.init(d);window.ParsleyConfig={excluded:"input[type=button], input[type=submit], input[type=reset]",inputs:"input, textarea, select, input[type=hidden], :hidden"};this.destroyDelegate=h.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};h.BookingWizard.prototype.init=function(d){d=i.extend({},d);this.$root=i(d.elem);this.projectId=d.projectId;this.$bookingButton=this.$root.find(d.bookingButton);this.$nextButton=this.$root.find(d.nextButton);
this.$backButton=this.$root.find(d.backButton);this.$step1=this.$root.find(d.step1);this.$tabs=this.$root.find(d.tabs);this.$errorContainer=this.$root.find(d.errorContainer);if(this.$tabs.length<2){this.$step1&&this.$step1.tab("show");this.$nextButton.addClass("hide");this.$backButton.addClass("hide")}else{this.wizardButtonClickDelegate=h.createDelegate(this,this.wizardButtonClick);this.$nextButton.on("click",this.wizardButtonClickDelegate);this.$backButton.on("click",this.wizardButtonClickDelegate);
this.toggleButtons(0);this.tabsClickDelegate=h.createDelegate(this,this.tabsClick);this.$tabs.on("click",this.tabsClickDelegate)}};h.BookingWizard.prototype.validate=function(){this.isValid()?this.$errorContainer.addClass("hide"):this.$errorContainer.removeClass("hide")};h.BookingWizard.prototype.tabsClick=function(d){var a=i(d.currentTarget);d.preventDefault();this.validate();this.toggleButtons(a.data("step"))};h.BookingWizard.prototype.toggleButtons=function(d){if(parseInt(d,10)===0){this.$bookingButton.addClass("hide");
this.$nextButton.removeClass("hide");this.$backButton.addClass("hide")}else{this.$bookingButton.removeClass("hide");this.$nextButton.addClass("hide");this.$backButton.removeClass("hide")}i(".booki"+this.projectId+'.nav.nav-tabs a[data-step="'+d+'"]').tab("show")};h.BookingWizard.prototype.wizardButtonClick=function(d){d=i(d.currentTarget);this.validate();this.toggleButtons(d.data("step"))};h.BookingWizard.prototype.isValid=function(){var d=true;this.$root.find(".booki_parsley_validated").each(function(){var a=
i(this);window.console.log(a[0].name+":"+(!a.is(":visible")&&a[0].type!=="hidden"));if(!a.is(":visible")&&a[0].type!=="hidden"||a.is(":disabled"))return true;a=a.parsley().validate(true);if(a!==null&&typeof a==="object"&&a.length>0)d=false});return d};h.BookingWizard.prototype.destroy=function(){if(this.wizardButtonClickDelegate){this.$nextButton.off();this.$backButton.off();delete this.wizardButtonClickDelegate}if(this.tabsClickDelegate){this.$tabs.off();delete this.tabsClickDelegate}if(this.destroyDelegate){i(window).off("unload",
this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.moment,window.Booki);
(function(i,m){m.ModalPopup=function(h){this.init(h);this.destroyDelegate=m.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};m.ModalPopup.prototype.init=function(h){h=i.extend({},h).elem;this.$root=i(h);this.$confirmButton=this.$root.find(".booki-confirm");this.onModalShowDelegate=m.createDelegate(this,this.onModalShow);this.$root.on("show.bs.modal",this.onModalShowDelegate)};m.ModalPopup.prototype.onModalShow=function(h){this.$confirmButton.attr("value",i(h.relatedTarget).data("bookiId"))};
m.ModalPopup.prototype.destroy=function(){if(this.onModalShowDelegate){this.$root.off();delete this.onModalShowDelegate}if(this.destroyDelegate){i(window).off("unload",this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.Booki);
(function(i,m,h){h.SearchFilter=function(d){this.init(d);this.destroyDelegate=h.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};h.SearchFilter.prototype.init=function(d){d=i.extend({},d);var a;this.$root=i(d.elem);this.fromDefaultDate=m(d.fromDefaultDate);this.toDefaultDate=m(d.toDefaultDate);this.$fromDate=this.$root.find(d.fromDateElem);this.$toDate=this.$root.find(d.toDateElem);this.calendarFirstDay=d.calendarFirstDay;this.showCalendarButtonPanel=d.showCalendarButtonPanel;
this.calendarCssClasses=d.calendarCssClasses;this.altFormat=d.altFormat;this.dateFormat=d.dateFormat;d={dateFormat:this.altFormat,changeMonth:true,changeYear:true,minDate:0,showButtonPanel:this.showCalendarButtonPanel};if(this.fromDefaultDate)d.defaultDate=this.fromDefaultDate._d;a={dateFormat:this.altFormat,changeMonth:true,changeYear:true,minDate:0,showButtonPanel:this.showCalendarButtonPanel};if(this.toDefaultDate)a.defaultDate=this.toDefaultDate._d;if(this.calendarFirstDay<7){a.firstDay=this.calendarFirstDay;
d.firstDay=this.calendarFirstDay}if(this.$fromDate.length>0){this.$fromDate.datepicker(d);this.calendarCssClasses&&this.$fromDate.addClass(this.calendarCssClasses)}if(this.$toDate.length>0){this.$toDate.datepicker(a);this.calendarCssClasses&&this.$toDate.addClass(this.calendarCssClasses)}this.calendarCssClasses&&i("#ui-datepicker-div").addClass(this.calendarCssClasses)};h.SearchFilter.prototype.destroy=function(){if(this.destroyDelegate){i(window).off("unload",this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,
window.moment,window.Booki);
(function(i,m,h){h.TimezoneControl=function(d){this.init(d);this.destroyDelegate=h.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};h.TimezoneControl.prototype.init=function(d){d=i.extend({},d);var a=this;this.$root=i(d.elem);this.cookieName="BOOKITIMEZONE";this.flag=false;this.$regionSelect=this.$root.find(d.region);this.$timezoneContainer=this.$root.find(d.timezone);this.$timezoneSelect=this.$timezoneContainer.find('select[name="timezone"]');this.$autoDetect=this.$root.find('input[name="autodetect"]');
this.$headerCaption=this.$root.find(d.headerCaption);this.$loadOnStart=i(d.loadOnStart);this.$timezoneManualSelection=i(d.timezoneManualSelection);this.$collapseTimezone=this.$root.find(".collapseTimezone");this.$progressBar=this.$root.find(".progress");this.ajaxUrl=d.ajaxurl;this.timezoneSelectChangeDelegate=h.createDelegate(this,this.timezoneSelectChange);this.$timezoneSelect.on("change",this.timezoneSelectChangeDelegate);this.regionSelectChangeDelegate=h.createDelegate(this,this.regionSelectChange);
this.$regionSelect.on("change",this.regionSelectChangeDelegate);if(this.$autoDetect.length>0){this.autoDetectClickDelegate=h.createDelegate(this,this.autoDetectClick);this.$autoDetect.on("click",this.autoDetectClickDelegate)}d=this.getDefaultTimezone();this.$autoDetect.prop("checked",d.autoRun);if(this.$timezoneManualSelection.length>0){d.selectedZone=this.$timezoneManualSelection.val();this.$root.find(".autodetect").addClass("hide")}this.saveState(d.autoRun,d.selectedZone);if(this.$headerCaption.length>
0){this.$headerCaption[0].title="";this.$headerCaption.html(d.selectedZone)}i(document).ajaxStop(function(){a.$progressBar&&a.$progressBar.addClass("hide")})};h.TimezoneControl.prototype.autoDetectClick=function(d){d=i(d.currentTarget).is(":checked");var a;if(d)a=this.guessTimezone(null,true);else{a=this.readState();a=a.selectedZone}this.saveState(d,a)};h.TimezoneControl.prototype.regionSelectChange=function(d){this.timezoneChoice(i(d.currentTarget).val(),null)};h.TimezoneControl.prototype.timezoneSelectChange=
function(d){if(this.flag)this.flag=false;else{d=i(d.currentTarget).find(":selected");this.$headerCaption.html(d.text());this.$autoDetect.prop("checked",false);this.saveState(false,d.val());this.$collapseTimezone.collapse("hide")}};h.TimezoneControl.prototype.getDefaultTimezone=function(){var d=h.Cookie.read(this.cookieName);if(!d){d=m.determine();return{autoRun:true,selectedZone:d.name()}}d=d.split(":");return{autoRun:d[0]==="true",selectedZone:d[1]==="null"?null:d[1]}};h.TimezoneControl.prototype.parseSavedState=
function(d){if(!d)return{autoRun:true,selectedZone:null};d=d.split(":");return{autoRun:d[0]==="true",selectedZone:d[1]==="null"?null:d[1]}};h.TimezoneControl.prototype.readState=function(d){var a,b;if(this.$timezoneManualSelection.length>0)return this.parseSavedState();d=typeof d==="undefined"?true:d;a=h.Cookie.read(this.cookieName);b=this.$autoDetect.is(":checked");if(!a&&d){d=this.guessTimezone();a=this.saveState(b,d)}return this.parseSavedState(a)};h.TimezoneControl.prototype.saveState=function(d,
a){if(this.$timezoneManualSelection.length>0)return this.parseSavedState();var b=h.Cookie.read(this.cookieName),c=d+":"+a;if(c!==b){h.Cookie.erase(this.cookieName);h.Cookie.create(this.cookieName,c,30);return c}return b};h.TimezoneControl.prototype.guessTimezone=function(d,a){var b=m.determine();if(d=typeof d==="undefined"||d===null?b.name():d){(b=d.substr(0,d.indexOf("/")))||(b=d);this.timezoneChoice(b,d,a);return d}};h.TimezoneControl.prototype.timezoneChoice=function(d,a,b){if(d==="-1"){this.$timezoneContainer.addClass("hide");
this.$timezoneSelect.empty()}else{this.$progressBar.removeClass("hide");(function(c,e,f,g){i.post(g.ajaxUrl,{model:{region:c,selectedZone:e},action:"booki_timezoneChoice"},function(j){if(j=(j=i.parseJSON(j).result)?j.options:null){g.$regionSelect.length>0&&g.$regionSelect.val(c);if(g.$timezoneContainer.length>0){g.$timezoneSelect.html(j);g.$timezoneContainer.removeClass("hide");if(e){j=g.$timezoneSelect.find(":selected");if(g.$headerCaption.length>0){g.$headerCaption[0].title=j.text();g.$headerCaption.html(j.val())}}if(g.$loadOnStart.length>
0&&f)window.setTimeout(function(){g.flag=true;g.$timezoneSelect.change()},500);else e&&g.$collapseTimezone.collapse("hide")}}})})(d,a,b,this)}};h.TimezoneControl.prototype.destroy=function(){if(this.timezoneSelectChangeDelegate){this.$timezoneSelect.off();delete this.timezoneSelectChangeDelegate}if(this.regionSelectChangeDelegate){this.$regionSelect.off();delete this.regionSelectChangeDelegate}if(this.autoDetectClickDelegate){this.$autoDetect.off();delete this.autoDetectClickDelegate}if(this.destroyDelegate){i(window).off("unload",
this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.jstz,window.Booki);
(function(i,m,h){h.TimezoneControlState=function(d){this.init(d);this.destroyDelegate=h.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};h.TimezoneControlState.cookieName="BOOKITIMEZONE";h.TimezoneControlState.prototype.init=function(d){d=i.extend({},d).elem;var a=this,b=h.TimezoneControlState.readState();this.$root=i(d);this.$root.each(function(){var c=i(this),e=c.prop("href");e=a.updateQueryString(e,"timezone",b.selectedZone);c.prop("href",e)})};h.TimezoneControlState.parseSavedState=
function(d){if(!d)return{autoRun:true,selectedZone:null};d=d.split(":");return{autoRun:d[0]==="true",selectedZone:d[1]==="null"?null:d[1]}};h.TimezoneControlState.readState=function(){var d=h.Cookie.read(h.TimezoneControlState.cookieName);if(!d){d=h.TimezoneControlState.guessTimezone();d=h.TimezoneControlState.saveState(true,d)}return h.TimezoneControlState.parseSavedState(d)};h.TimezoneControlState.saveState=function(d,a){var b=h.Cookie.read(h.TimezoneControlState.cookieName),c=d+":"+a;if(c!==b){h.Cookie.erase(h.TimezoneControlState.cookieName);
h.Cookie.create(h.TimezoneControlState.cookieName,c,30);return c}return b};h.TimezoneControlState.guessTimezone=function(){return m.determine().name()};h.TimezoneControlState.prototype.updateQueryString=function(d,a,b){var c=RegExp("(\\?|\\&)"+a+"=.*?(?=(&|$))");d=d.toString().split("#");var e=d[1],f=/\?.+$/;d=d[0];a=c.test(d)?d.replace(c,"$1"+a+"="+b):f.test(d)?d+"&"+a+"="+b:d+"?"+a+"="+b;if(e)a+="#"+e;return a};h.TimezoneControlState.prototype.destroy=function(){if(this.destroyDelegate){i(window).off("unload",
this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.jstz,window.Booki);
(function(i,m){m.UserInfo=function(h){this.init(h);this.destroyDelegate=m.createDelegate(this,this.destroy);i(window).unload(this.destroyDelegate)};m.UserInfo.prototype.init=function(h){h=i.extend({},h);var d=this;this.$root=i(h.elem);this.$triggerButton=this.$root.find(h.triggerButton);this.$userIdField=this.$root.find(h.userIdField);this.userFoundMessage=h.userFoundMessage;this.userNotFoundMessage=h.userNotFoundMessage;this.successCallback=h.success;this.ajaxUrl=h.ajaxUrl;this.$userEmailInfo=this.$root.find(".useremail-info");
this.$progressBar=this.$root.find(".progress.booki-useremail");this.$userEmailTextbox=this.$root.find("#useremail");i(document).ajaxStop(function(){d.$progressBar.addClass("hide")});if(this.$triggerButton.length>0){this.triggerClickDelegate=m.createDelegate(this,this.triggerClick);this.$triggerButton.click(this.triggerClickDelegate)}else{this.userEmailChangedDelegate=m.createDelegate(this,this.userEmailChanged);this.$userEmailTextbox.change(this.userEmailChangedDelegate)}};m.UserInfo.prototype.userEmailChanged=
function(h){this.getUserInfo(i(h.currentTarget).val())};m.UserInfo.prototype.triggerClick=function(){this.getUserInfo(this.$userEmailTextbox.val());return false};m.UserInfo.prototype.getUserInfo=function(h){if(i("#useremail").parsley().validate(true)===true){this.$progressBar.removeClass("hide");(function(d,a){i.post(a.ajaxUrl,{model:{email:d},action:"booki_getUserByEmail"},function(b){b=i.parseJSON(b).result;var c,e,f;if(b){c=b.userName;e=b.firstName;f=b.lastName;a.$userIdField&&a.$userIdField.val(b.id);
if(e){c=e;if(f)c+=" "+f}a.$userEmailInfo.removeClass("hide");if(c){a.$userEmailInfo.html(a.userFoundMessage+": "+c);if(a.successCallback)a.successCallback();else if(a.$triggerButton){a.$triggerButton.off();a.$triggerButton.click()}}else a.$userEmailInfo.html('<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+a.userNotFoundMessage)}a.$progressBar.addClass("hide")})})(h,this)}};m.UserInfo.prototype.destroy=function(){if(this.triggerClickDelegate){this.$triggerButton.off();
delete this.triggerClickDelegate}if(this.userEmailChangedDelegate){this.$userEmailTextbox.off();delete this.userEmailChangedDelegate}if(this.destroyDelegate){i(window).off("unload",this.destroyDelegate);delete this.destroyDelegate}}})(window.jQuery,window.Booki);
